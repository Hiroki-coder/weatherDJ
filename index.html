<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>天気に合わせたYouTubeプレイリスト</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin-bottom: 10px;
    }
    #status {
      margin: 10px 0;
      color: #333;
    }
    #weather-info {
      margin: 10px 0 20px;
      padding: 10px 15px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
      min-width: 260px;
      text-align: center;
    }
    #player-container {
      width: 100%;
      max-width: 640px;
      aspect-ratio: 16 / 9;
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    button {
      margin-top: 10px;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      background: #1976d2;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background: #1565c0;
    }
  </style>
</head>
<body>
  <h1>天気に合わせたYouTubeプレイリスト</h1>
  <div id="status">現在地の天気を取得中...</div>
  <div id="weather-info"></div>
  <div id="player-container"></div>
  <button id="reload-btn">もう一度取得する</button>

  <script>
    // ★ここを書き換える★
    const OPENWEATHER_API_KEY = "5f500a289ba548bd18980b9e388c84a3";

    // 天気ごとのYouTubeプレイリストIDマッピング
    // 実際のプレイリストIDに差し替えてください
    const playlistMap = {
      clear: "",   // 晴れ
      clouds: "PLX4uvrPUzOfsK-mQUSOHyKsXNR6ssLeMd",  // 曇り
      rain: "PLX4uvrPUzOfvhLFY5A83zE_DzNAVpRFy0&si=3q_Wkzn__TXKF9EQ",    // 雨
      snow: "PLxxxxxxxxxxxx4",    // 雪
      thunderstorm: "PLxxxxxxxxxxxx5", // 雷
      drizzle: "PLxxxxxxxxxxxx6", // 霧雨
      default: ""  // その他・予備
    };

    const statusEl = document.getElementById("status");
    const weatherInfoEl = document.getElementById("weather-info");
    const playerContainerEl = document.getElementById("player-container");
    const reloadBtn = document.getElementById("reload-btn");

    reloadBtn.addEventListener("click", () => {
      statusEl.textContent = "現在地の天気を取得中...";
      weatherInfoEl.textContent = "";
      playerContainerEl.innerHTML = "";
      getWeatherAndSetPlaylist();
    });

    // 現在地の天気を取得してプレイリストをセット
    function getWeatherAndSetPlaylist() {
      if (!navigator.geolocation) {
        statusEl.textContent = "このブラウザでは位置情報が利用できません。";
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          fetchWeather(lat, lon);
        },
        (err) => {
          console.error(err);
          statusEl.textContent = "位置情報の取得に失敗しました。ブラウザの設定を確認してください。";
        }
      );
    }

    // OpenWeatherMapから天気情報を取得
    function fetchWeather(lat, lon) {
      const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${OPENWEATHER_API_KEY}&units=metric&lang=ja`;

      fetch(url)
        .then((res) => {
          if (!res.ok) {
            throw new Error("天気情報の取得に失敗しました");
          }
          return res.json();
        })
        .then((data) => {
          console.log(data);
          const weatherMain = data.weather[0].main.toLowerCase(); // Clear, Clouds, Rain...
          const description = data.weather[0].description;
          const temp = data.main.temp;
          const city = data.name;

          statusEl.textContent = "現在地の天気を取得しました。";
          weatherInfoEl.innerHTML = `
            <div><strong>場所：</strong>${city}</div>
            <div><strong>天気：</strong>${description}</div>
            <div><strong>気温：</strong>${temp.toFixed(1)} ℃</div>
          `;

          const playlistId = choosePlaylist(weatherMain);
          setYouTubePlaylist(playlistId);
        })
        .catch((err) => {
          console.error(err);
          statusEl.textContent = "天気情報の取得中にエラーが発生しました。";
        });
    }

    // 天気に応じてプレイリストIDを選択
    function choosePlaylist(weatherMain) {
      if (weatherMain.includes("clear")) return playlistMap.clear;
      if (weatherMain.includes("cloud")) return playlistMap.clouds;
      if (weatherMain.includes("rain")) return playlistMap.rain;
      if (weatherMain.includes("snow")) return playlistMap.snow;
      if (weatherMain.includes("thunder")) return playlistMap.thunderstorm;
      if (weatherMain.includes("drizzle")) return playlistMap.drizzle;
      return playlistMap.default;
    }

    // YouTubeプレイリストをiframeで埋め込み
    function setYouTubePlaylist(playlistId) {
      const src = `https://www.youtube.com/embed/videoseries?list=${playlistId}&autoplay=1`;
      playerContainerEl.innerHTML = `
        <iframe
          src="${src}"
          title="YouTube playlist player"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
        ></iframe>
      `;
    }

    // 初回実行
    getWeatherAndSetPlaylist();
  </script>
</body>
</html># weatherDJ
